<!DOCTYPE html>
<head>
	<!-- Load plotly.js into the DOM -->
	<script src='https://cdn.plot.ly/plotly-2.16.1.min.js'></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js'></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

</head>

<body>
<hr>
<div>
			<!-- Ticker picker -->
                <label>Pick your ticker</label>
                <input type="name" id="tickername" name="tickername">
				<button class="plot-button" onclick="getdata()">Get Data</button>
</div>
<hr>

	<div id='myDiv'><!-- Plotly chart will be drawn inside this DIV --></div>
</body>
<script>

function getdata(){

	var tickername = document.getElementById("tickername").value

	const settings = {
		"async": true,
		"crossDomain": true,
		"url": "https://mboum-finance.p.rapidapi.com/hi/history?symbol="+tickername+"&interval=1d&diffandsplits=false",
		"method": "GET",
		"headers": {
			"X-RapidAPI-Key": "cb13e099f6msh76bac0554262195p1e57e4jsnec3cb7675f2c",
			"X-RapidAPI-Host": "mboum-finance.p.rapidapi.com"
		}
	};

$.ajax(settings).done(function (response) {
	//console.log(response);
	plotting(response);

});

}
// var myJson = '{"data":[{"y":[1,2,3]}],"layout":{"title":"my graph"}}';
// var figure = JSON.parse(myJson);

// Plotly.newPlot('myDiv', figure.data, figure.layout);


function plotting(data){

	//const parsed = JSON.stringify(data);
	//console.log(parsed.items[0].close);
	// d3.json(data, function(err, rows){

	// 	function unpack(rows, key) {
	// 	return rows.map(function(row) { return row[key]; });
	// }
	var dates = [];
	var closes = [];
	var open1 = [];
	for (var key in data["items"]){
  	// console.log(, data["items"][key]["close"]);
  	dates.push(data["items"][key]["date"])
  	closes.push(data["items"][key]["close"])
	open1.push(data["items"][key]["open"])
	}

	var trace1 = {
	type: "scatter",
	mode: "lines",
	name: 'Stock Close',
	x: dates,
	y: closes,
	line: {color: '#17BECF'}
	}

	var trace2 = {
	type: "scatter",
	mode: "lines",
	name: 'Stock 2 Close',
	x: dates,
	y: open1,
	line: {color: '#7F7F7F'}
	}

	var data2 = [trace1,trace2];

	var layout = {
	title: 'Basic Time Series',
	};

	Plotly.newPlot('myDiv', data2, layout);
}



</script>